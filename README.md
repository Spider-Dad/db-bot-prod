# Telegram Birthday Bot

Telegram бот для управления и отправки напоминаний о днях рождения с функциями администрирования.


## Основные возможности

- Отображение списка дней рождения с группировкой по месяцам на русском языке
- Комплексное управление базой данных пользователей и их настройками
- Автоматическое создание резервных копий с возможностью восстановления
- Система администрирования с расширенными командами
- Настраиваемые шаблоны уведомлений с HTML-форматированием
- Управление подписками пользователей на уведомления
- Интеллектуальная система рассылки напоминаний
- Защита от множественных запусков бота
- Система кэширования для оптимизации отправки уведомлений

## Структура проекта

```
├── bot/
│   ├── __init__.py          # Инициализация модулей бота
│   ├── database.py          # Управление базой данных
│   ├── handlers.py          # Обработчики команд бота
│   ├── utils.py             # Вспомогательные функции
│   ├── message_templates.py # Шаблоны сообщений
│   └── notification_manager.py # Управление уведомлениями
├── data/                    # Директория данных (абсолютный путь)
│   ├── birthday_bot.db     # База данных SQLite
│   ├── db_schema.sql       # Схема базы данных
│   ├── bot.lock            # Файл блокировки для предотвращения множественных запусков
│   └── backups/            # Резервные копии
└── config.py               # Конфигурация бота
```

## Команды

### Пользовательские команды
- `/start` - Запустить бота и подтвердить подписку на уведомления
- `/birthdays` - Показать список дней рождения с группировкой по месяцам

### Административные команды
#### Управление пользователями
- `/add_user` - Добавить пользователя в систему
- `/remove_user` - Удалить пользователя из системы
- `/toggle_notifications` - Управление уведомлениями пользователя
- `/users` - Просмотр справочника пользователей
- `/set_admin` - Назначить пользователя администратором
- `/remove_admin` - Отозвать права администратора

#### Управление шаблонами и уведомлениями
- `/get_templates` - Просмотр списка шаблонов
- `/set_template` - Добавить новый шаблон
- `/update_template` - Обновить существующий шаблон
- `/test_template` - Тестирование шаблона
- `/preview_template` - Предпросмотр шаблона
- `/delete_template` - Удалить шаблон
- `/activate_template` - Активировать шаблон
- `/deactivate_template` - Деактивировать шаблон
- `/help_template` - Помощь по шаблонам

#### Управление настройками
- `/get_settings` - Просмотр настроек уведомлений
- `/set_setting` - Добавить настройку уведомлений
- `/edit_setting` - Изменить настройку уведомлений
- `/delete_setting` - Удалить настройку уведомлений

#### Управление резервными копиями
- `/backup` - Создать резервную копию базы данных
- `/list_backups` - Показать список доступных резервных копий
- `/restore` - Восстановить базу из резервной копии

## Технические характеристики

- Python 3.11
- Telegram Bot API
- SQLite для хранения данных
- HTML форматирование сообщений
- Система кэширования для оптимизации
- Автоматическое резервное копирование
- Локализация на русский язык
- Поддержка часовых поясов (MSK)
- Механизм блокировки для предотвращения множественных запусков

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone [URL репозитория]
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте переменные окружения:
   - `BOT_TOKEN` - Токен вашего Telegram бота
   - `ADMIN_IDS` - ID администраторов (через запятую)

4. Запустите бота:
```bash
python main.py
```

## Особенности реализации

### Форматирование сообщений
- Поддержка HTML-тегов в сообщениях
- Правильные падежи для русских месяцев
- Интуитивно понятные emoji в сообщениях
- Предпросмотр шаблонов перед сохранением

### База данных
- Автоматическое создание структуры при первом запуске
- Система миграций
- Автоматическое резервное копирование
- Возможность восстановления из бэкапа
- Абсолютные пути для хранения данных

### Безопасность
- Проверка прав доступа для административных команд
- Валидация пользовательского ввода
- Защита от несанкционированного доступа
- Блокировка множественных запусков бота

### Уведомления
- Настраиваемые интервалы отправки
- Поддержка различных шаблонов
- Система подтверждения подписки
- Отслеживание статуса доставки
- Кэширование для оптимизации отправки
- Обработка часовых поясов

### Оптимизация
- Кэширование отправленных уведомлений
- Периодическая очистка кэша
- Интеллектуальная система перезагрузки настроек
- Эффективное использование системных ресурсов

## Локализация

Бот полностью локализован на русский язык, включая:
- Все сообщения и команды
- Форматирование дат
- Названия месяцев с правильными падежами
- Системные уведомления
- Сообщения об ошибках
- Административные команды